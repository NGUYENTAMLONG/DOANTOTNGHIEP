<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <meta http-equiv="refresh" content="5"> -->
  <title>CENSORSHIP BLOG</title>
  <%- include("../../partials/link") %>
  <link rel="icon" href="/image/tablogo.png">
  <link rel="stylesheet" href="/css/profile.css">
  <link rel="stylesheet" href="/css/readBlog.css">
  <link rel="stylesheet" href="/css/rating.css">
  <!----===== Boxicons CSS ===== -->
  <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
  <%- include("../../admin/partials/header") %>
  <section class="section container  bg-light" id="section-1">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb mt-2">
        <li class="breadcrumb-item"><a href="/management/content/blog">Quản lí blog</a></li>
        <li class="breadcrumb-item active" aria-current="page">Chờ phê duệt</li>
      </ol>
    </nav>

    <div class="container">
      <div class="row">
        <div class="col-sm-12 col-lg-8 p-2">
          <div class="blog">
            <div class="blog__info">
              <h2 class="text-center m-3"><%= blog.title %></h2>
              <span class="badge badge-warning">Đang chờ phê duyệt <i class="fas fa-spinner fa-pulse"></i></span>
              <p class="float-right"><b class="text-danger"><%= blog.author %></b> - <i class="fas fa-clock"></i> <%= moment(blog.updatedAt).format("L")%> <%=  moment(blog.updatedAt).format("LT")%> </p>
            </div>
            <div class="blog__content">
              <div class="blog__content__desc">
                <b>
                  <%= blog.desc %>
                </b>
              </div>
              <img src="<%= blog.cover %>" width="100%" class="mt-3 mb-3" alt="">
              <hr class="m-3">
              <span class="blog__content__main mt-4"><%- blog.content %></span>
            </div>
            <div class="blog__more__info">
              <hr>
              <i>Nguồn </i><b class="blog__source"><%= blog.source %></b>
              <% if (blog.link) {%>
              <span class="float-right"><a href='<%= blog.link %>' class="blog__link"> Link gốc tham khảo</a></span>
              <% } %>
              <hr>
              <i>Từ khóa</i>
              <% blog.keywords.forEach((keyword)=>{%>
              <a href="# " class="blog__keyword bg-secondary text-light"># <%= keyword %></a>
              <%}) %>
              <hr>
            </div>
          </div>
        </div>
        <div class="col-sm-12 col-lg-4 p-2">
          <div class="text-center">
            <button class="btn btn-success" onclick="acceptBlog('<%= blog._id%>')"> Duyệt <i class="fas fa-check-circle"></i></button>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div id="to-top">
    <i class="fas fa-angle-up fa-3x" onclick="toTop()"></i>
  </div>
</body>
<%- include("../../partials/script") %>

<script src="/js/moment-with-locales.min.js"></script>
<script>
  function acceptBlog(blogId) {
    const payload = {
      blogId
    }
    fetch('/management/content/blog/api/accept-blog', {
        method: 'PATCH', // or 'PUT'
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payload),
      })
      .then(response => response.json())
      .then(result => {
        console.log(result)
        if (!result.isSuccess && result.errorCode === "BAD_REQUEST") {
          swal({
            title: "Thông báo",
            text: "Đã có lỗi khi phê duyệt !",
            icon: "error",
            button: "Ok!",
          })
        } else {
          swal({
            title: "Thành công",
            text: "Đã phê duyệt !",
            icon: "success",
            button: "Ok!",
          }).then(() => {
            window.location.href = "/management/content/blog"
          })
        }
      })
      .catch((error) => {
        console.log('Error:', error);
      })
  }

  function toTop() {
    window.scrollTo(0, 0);
  }
</script>

</html>