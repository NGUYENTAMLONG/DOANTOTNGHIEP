<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <meta http-equiv="refresh" content="5"> -->
  <title>DETAIL FORUM</title>
  <%- include("../partials/link") %>
  <link rel="icon" href="/image/tablogo.png">
  <link rel="stylesheet" href="/css/forum_detail.css">
  <link rel="stylesheet" href="/css/forum_review.css">
  <!----===== Boxicons CSS ===== -->
  <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
  <%- include('../partials/header') %>

  <div class="container">
    <div class="section" id="section-1">
      <div class="row">
        <div class="col-3">
          <div class="info-left">
            <div class="manga__name text-center">
              <h2><%= manga.title %></h2>
            </div>
            <div class="manga__cover">
              <img src="<%= manga.images.jpg.image_url %>" width="100%" alt="">
            </div>
            <div class="manga__paticals">
              <p>Add to My List</p>
              <hr>
              <p>Add to My Favorites</p>
              <hr>
              <div class="share d-flex flex-wrap justify-content-around">
                <span>
                  <i class="fab fa-2x fa-facebook-square"></i>
                </span>
                <span>
                  <i class="fab fa-2x fa-instagram-square"></i>
                </span>
                <span>
                  <i class="fab fa-2x fa-pinterest-square"></i>
                </span>
                <span>
                  <i class="fab fa-2x fa-tumblr-square"></i>
                </span><span>
                  <i class="fab fa-2x fa-twitter-square"></i>
                </span><span>
                  <i class="fab fa-2x fa-reddit-square"></i>
                </span>
              </div>
              <br>
              <h5>Alternative Titles</h5>
              <hr>
              <span><b>Default Name:</b> <%= manga.title %> </span>
              <span><b>Japanese Name:</b> <%= (manga.title_japanse) ? manga.title_japanse : 'unknown' %> </span>
              <span><b>English Name:</b>
                <%= (manga.title_english) ? manga.title_english : 'unknown' %> </span>
              <h5 class="mt-4">Information</h5>
              <hr>
              <div><b>Author:</b>
                <% manga.authors.forEach(function(author,index){%>
                <a href="/forum/author/<%= author.mal_id %>">
                  <%= author.name %>
                </a> <%= (index ===  manga.authors.length -1) ? '.' : "," %>
                <%}) %>
              </div>
              <div><b>Type:</b> <%= (manga.type) ? manga.type : 'unknown'%></div>
              <div><b>Published:</b> <%= (manga.published.string) ?manga.published.string : 'unknown' %></div>
              <div><b>Chapter:</b> <%= (manga.chapters) ? manga.chapters : 'unknown' %></div>
              <div><b>Volumes:</b> <%= (manga.volumes) ? manga.volumes : 'unknown' %></div>
              <div><b>Status:</b>
                <%= (manga.status) ? manga.status : 'unknown' %>
              </div>
              <div><b>Genres:</b>
                <% manga.genres.forEach(function(type,index){%>
                <a href="<%= type.url %>" target="_blank">
                  <%= type.name %>
                </a>
                <%}) %>
              </div>
              <div><b>Demographic:</b>
                <% manga.demographics.forEach(function(demographic,index){%>
                <a href="<%= demographic.url %>" target="_blank">
                  <%= demographic.name %>
                </a>
                <%}) %>
              </div>
              <div><b>Serialization:</b>
                <% manga.serializations.forEach(function(serialization,index){%>
                <a href="<%= serialization.url %>" target="_blank">
                  <%= serialization.name %>
                </a>
                <%}) %>
              </div>
            </div>
          </div>
        </div>
        <div class="col-9">
          <div class="row info-right">
            <nav aria-label="breadcrumb">
              <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/forum">Forum</a></li>
                <li class="breadcrumb-item active" aria-current="page">Reviews</li>
              </ol>
            </nav>
            <ul class="navigation">
              <li><a href="#" class="disabled">Detail</a></li>
              <li><a href="/forum/author/<%= manga.authors[0].mal_id %>">Author</a></li>
              <li><a href="#">Characters</a></li>
              <li><a href="#">News</a></li>
              <li><a href="#">Statistics</a></li>
              <li><a href="/forum/review/<%= manga.authors[0].mal_id %>">Reviews</a></li>
              <li><a href="/forum/recommendations/<%= manga.mal_id %>">Recommendations</a></li>
              <li><a href="#">Interest Stacks</a></li>
              <li><a href="#">Forum</a></li>
              <li><a href="#">Clubs</a></li>
              <li><a href="#">Pictures</a></li>
            </ul>
            <div class="reviews mt-4">
              <h4>Reviews</h4>
              <hr>
              <div class="d-flex flex-column">
                <% reviews.forEach(function(review,index){%>
                <div class="review d-flex">
                  <div class="review__avatar">
                    <img src="<%= review.user.images.jpg.image_url%>" alt="">
                  </div>
                  <div class="review__content">
                    <div class="review__content-name">
                      <a href="#">
                        <b><%= review.user.username %></b>
                      </a>
                    </div>
                    <div class="review__content-tags">
                      <% review.tags.forEach(function(tag,index){%>
                      <% if (tag === 'Recommended') {%>
                      <span class="badge badge-success"><%= tag %> </span>
                      <%}else if(tag === 'Not Recommended'){%>
                      <span class="badge badge-danger">
                        <%= tag %>
                      </span>
                      <%}else{%>
                      <span class="badge badge-warning">
                        <%= tag %>
                      </span>
                      <%} %>
                      <%}) %>
                    </div>
                    <p class="review__content-review">
                      <%= review.review %>
                    </p>
                    <div class="review__content-reaction">
                      <div class="icons d-flex">
                        <div class="nice">
                          <i class='bx bxs-like' data-toggle="tooltip" data-placement="bottom" title="nice"></i> <%= review.reactions.nice %>
                        </div>
                        <div class="love">
                          <i class='bx bxs-heart' data-toggle="tooltip" data-placement="bottom" title="love it"></i> <%= review.reactions.love_it %>
                        </div>
                        <div class="funny">
                          <i class='bx bx-wink-smile' data-toggle="tooltip" data-placement="bottom" title="funny"></i> <%= review.reactions.funny %>
                        </div>
                        <div class="confusing">
                          <i class='bx bx-question-mark' data-toggle="tooltip" data-placement="bottom" title="confusing"></i> <%= review.reactions.confusing %>
                        </div>
                        <div class="informative">
                          <i class='bx bxs-extension' data-toggle="tooltip" data-placement="bottom" title="informative"></i> <%= review.reactions.informative %>
                        </div>
                        <div class="well">
                          <i class='bx bx-paint' data-toggle="tooltip" data-placement="bottom" title="well written"></i> <%= review.reactions.well_written %>
                        </div>
                        <div class="creative">
                          <i class='bx bxs-leaf' data-toggle="tooltip" data-placement="bottom" title="creative"></i> <%= review.reactions.creative %>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <%}) %>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="section mt-4" id="section-2">
      <div class="row">
        <div class="genres-list"></div>
      </div>
    </div>
  </div>
  <%- include('../partials/footer') %>
</body>
<%- include("../partials/script") %>

<script>
  // Tooltips
  $(function() {
    $('[data-toggle="tooltip"]').tooltip();
  });

  fetch("/forum/genres").then((res) => res.json()).then((result) => {
    const htmls = result.data.map((elm, index) => `
       <a href="${elm.url}" target="_blank" class="m-1">
      <span class="badge badge-info">
        ${ elm.name } (${elm.count})
      </span>
      </a>
    `).join("")
    document.querySelector('.genres-list').innerHTML = htmls
    console.log(result)
  })
</script>

</html>