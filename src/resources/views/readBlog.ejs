<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <meta http-equiv="refresh" content="5"> -->
  <title>READ BLOG</title>
  <%- include("partials/link") %>
  <link rel="icon" href="/image/tablogo.png">
  <link rel="stylesheet" href="/css/profile.css">
  <link rel="stylesheet" href="/css/readBlog.css">
  <link rel="stylesheet" href="/css/rating.css">
  <!----===== Boxicons CSS ===== -->
  <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
</head>

<body>
  <%- include('partials/header') %>
  <section class="section container  bg-light" id="section-1">
    <div class="d-flex justify-content-center align-items-center">
      <nav aria-label="breadcrumb" style="width:90%">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="/blog">Blogs</a></li>
          <li class="breadcrumb-item active" aria-current="page">ƒê·ªçc</li>
        </ol>
      </nav>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-sm-12 col-lg-8 p-2">
          <div class="blog">
            <div class="blog__info">
              <h2 class="text-center m-3"><%= blog.title %></h2>
              <p class="float-right"><b class="text-danger"><%= blog.author %></b> - <i class="fas fa-clock"></i> <%= moment(blog.updatedAt).format("L")%> <%=  moment(blog.updatedAt).format("LT")%> </p>
            </div>
            <div class="blog__share">
              <div id="fb-root"></div>
              <script async defer crossorigin="anonymous" src="https://connect.facebook.net/vi_VN/sdk.js#xfbml=1&version=v14.0&appId=452307582987806&autoLogAppEvents=1" nonce="AckQt6Ew">
              </script>
              <div id="btn-share"></div>
            </div>
            <div class="blog__statistical" data-id="<%= blog._id %>">
              <span id="span-like" data-counter="<%= blog.statistical.likes %>">
              </span>
              <span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="L∆∞·ª£ng views">
                <i class="far fa-eye"></i> <%= blog.statistical.views %>
              </span>
              <span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="ƒêi·ªÉm ƒë√°nh gi√°" id="rate-blog-btn">
                <span class="rate" data-toggle="modal" data-target="#ratingModal">
                  <!-- Button trigger modal -->
                  <i class="far fa-star"></i> <%= blog.statistical.rating %>
                </span>
                <div class="modal fade" id="ratingModal" tabindex="-1" role="dialog" aria-labelledby="ratingModalLabel" aria-hidden="true">
                  <div class="modal-dialog" role="document">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="ratingModalLabel">üòç ƒê√°nh gi√° b√†i vi·∫øt t·∫°i ƒë√¢y üëá</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                          <span aria-hidden="true">&times;</span>
                        </button>
                      </div>
                      <div class="modal-body">
                        <div class="text-center">
                          <div class="row justify-content-center align-items-center">
                            <div class="center col-12 col-md-9">
                              <div id="rate" class="stars d-flex flex-row-reverse">
                                <label id="star5" onclick="rate(5)"></label>
                                <label id="star4" onclick="rate(4)"></label>
                                <label id="star3" onclick="rate(3)"></label>
                                <label id="star2" onclick="rate(2)"></label>
                                <label id="star1" onclick="rate(1)"></label>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-warning" onclick="ratingBlog('<%= blog._id %>')">ƒê√°nh gi√°</button>
                      </div>
                    </div>
                  </div>
                </div>
              </span>
              <span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="S·ªë l∆∞·ª£ng ƒë√°nh gi√°">
                <i class="fas fa-abacus"></i> <%= blog.statistical.counting %>
              </span>
              <span data-toggle="tooltip" data-placement="bottom" title="T·ªïng s·ªë b√¨nh lu·∫≠n">
                <i class="fas fa-comments"></i>
                <span id="count-comment" style="margin-left:-5px">
                </span>
              </span>
            </div>
            <div class="blog__content">
              <b class="blog__content__desc"><%= blog.desc %> </b>
              <img src="<%= blog.cover %>" width="100%" class="mt-3 mb-3" alt="">
              <hr class="m-3">
              <span class="blog__content__main mt-4"><%- blog.content %></span>
            </div>
            <div class="blog__more__info">
              <hr>
              <i>Ngu·ªìn </i><b class="blog__source"><%= blog.source %></b>
              <% if (blog.link) {%>
              <span class="float-right"><a href='<%= blog.link %>' class="blog__link"> Link g·ªëc tham kh·∫£o</a></span>
              <% } %>
              <hr>
              <i>T·ª´ kh√≥a</i>
              <% blog.keywords.forEach((keyword)=>{%>
              <a href="/blog/blog-with-keyword/<%= keyword %> " class="blog__keyword bg-secondary text-light"># <%= keyword %></a>
              <%}) %>
              <hr>
            </div>
            <div class="blog__comment">
              <div class="comments-area container bg-light">
                <div id="disqus_thread">
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="col-sm-12 col-lg-4 p-2">
          <div class="blog-box">
            <div class="blog-box__header">
              <div class="blog-box__header__title bg-primary">
                <b>
                  B√†i vi·∫øt c√πng th·ªÉ lo·∫°i
                </b>
              </div>
            </div>
            <div class="blog-box__list">
              <% blogsOfType.forEach(function(blogElm,index){ %>
              <% if(blogElm._id.toString() !== blog._id.toString() ){ %>
              <div class="blog-box__acticle">
                <a href="/blog/read/<%= blogElm.slug %>">
                  <img class="blog-box__acticle__cover" src="<%= blogElm.cover %>" />
                </a>
                <div class="blog-box__acticle__info">
                  <a href="/blog/read/<%= blogElm.slug %>">
                    <b><%= blogElm.title %> </b>
                  </a>
                </div>
              </div>
              <% } %>
              <% }) %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <div id="to-top">
    <i class="fas fa-angle-up fa-3x" onclick="toTop()"></i>
  </div>
  <%- include('partials/footer') %>
</body>
<%- include("partials/script") %>
<script src="/js/moment-with-locales.min.js"></script>
<script src="/js/rating.js"></script>
<script src="/js/plugins/readBlog.js"></script>
<!-- <script>
  $(function() {
    $('[data-toggle="tooltip"]').tooltip();
  });

  function shareSocial() {
    return `
<div class="fb-like" data-href="${window.location.href}" data-width="" data-layout="standard" data-action="like" data-size="small" data-share="true"></div>`
  }
  document.querySelector("#btn-share").innerHTML = shareSocial();
</script>
<script>
  (function() { // DON'T EDIT BELOW THIS LINE
    var d = document,
      s = d.createElement('script');
    s.src = 'https://my-site-zlkjtgow8a.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
  document.getElementById("count-comment").innerHTML = `<span class="disqus-comment-count" data-disqus-url="${window.location.href}"><i class="fa fa-spinner fa-spin"></i></span>`
</script>
<script>
  const blogId = document.querySelector(".blog__statistical").getAttribute("data-id");
  const likeSpan = document.getElementById("span-like");

  fetch("/user/blog/api/check-liked/" + blogId).then(res => res.json()).then((result) => {
    const counterLike = likeSpan.getAttribute("data-counter")
    if (!result.isSuccess) {
      likeSpan.innerHTML = `<span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="S·ªë l∆∞·ª£t th√≠ch" onclick="likeBlog('${blogId}')" id="like-blog-btn">
        <i class="far fa-thumbs-up"></i> ${counterLike}
      </span>`
    } else {
      const checkLiked = result.data;
      if (!checkLiked.liked) {
        likeSpan.innerHTML = `<span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="S·ªë l∆∞·ª£t th√≠ch" onclick="likeBlog('${blogId}')" id="like-blog-btn">
        <i class="far fa-thumbs-up"></i> ${counterLike}
          </span>`
      } else {
        likeSpan.innerHTML = `<span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="S·ªë l∆∞·ª£t th√≠ch" onclick="unlikeBlog('${blogId}')" id="like-blog-btn">
          <i class="fas fa-thumbs-up"></i> ${counterLike}
        </span>`
      }
    }
  }).catch((error) => console.log(error))

  function likeBlog(blogId) {
    const likeBtn = document.querySelector("#like-blog-btn");
    const data = {
      blogId: blogId,
    };
    fetch("/user/blog/api/like", {
        method: "POST", // or 'PUT'
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
      .then((response) => response.json())
      .then((result) => {
        const counterLike = likeSpan.getAttribute("data-counter")
        if (!result.isSuccess && result.errorCode === "UNAUTHORIZED") {
          swal({
            title: "Error",
            text: "H√£y ƒëƒÉng nh·∫≠p ƒë·ªÉ th·ª±c hi·ªán h√†nh ƒë·ªông n√†y nh√© :>",
            icon: "error",
            button: "OK!",
          });
        } else {
          swal({
            title: "ƒê√£ like",
            text: "C·∫£m ∆°n v√¨ ƒë√£ th√≠ch b√†i vi√™t n√†y ^^",
            icon: "success",
            button: "OK!",
          });
          likeSpan.innerHTML = `<span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="S·ªë l∆∞·ª£t th√≠ch" onclick="unlikeBlog('${blogId}')" id="like-blog-btn">
            <i class="fas fa-thumbs-up"></i> ${Number(counterLike) + 1}
            </span>`;
          likeSpan.setAttribute("data-counter", (Number(counterLike) + 1).toString())
        }
      })
      .catch((error) => {
        console.error("Error:", error);
      });
  }

  function unlikeBlog(blogId) {
    const likeBtn = document.querySelector("#like-blog-btn");
    const data = {
      blogId: blogId,
    };
    fetch("/user/blog/api/unlike", {
        method: "DELETE", // or 'PUT'
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
      .then((response) => response.json())
      .then((result) => {
        const counterLike = likeSpan.getAttribute("data-counter")
        if (!result.isSuccess) {
          swal({
            title: "Error",
            text: "L·ªói r·ªìi :(",
            icon: "error",
            button: "OK!",
          });
        } else {
          swal({
            title: "ƒê√£ unlike",
            text: "C·∫£m ∆°n v√¨ ƒë√£ t·ª´ng th√≠ch b√†i vi√™t n√†y...",
            icon: "success",
            button: "OK!",
          });
          likeSpan.innerHTML = `<span data-toggle="tooltip" class="mr-3" data-placement="bottom" title="S·ªë l∆∞·ª£t th√≠ch" onclick="likeBlog('${blogId}')" id="like-blog-btn">
                      <i class="far fa-thumbs-up"></i> ${Number(counterLike) - 1}
            </span>`
          likeSpan.setAttribute("data-counter", (Number(counterLike) - 1).toString())

        }
      })
      .catch((error) => {
        console.error("Error:", error);
      });
  }
</script> -->

</html>