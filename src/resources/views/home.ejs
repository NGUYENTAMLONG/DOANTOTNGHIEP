<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <meta http-equiv="refresh" content="5"> -->
  <title>HOME</title>
  <%- include("partials/link") %>
  <link rel="icon" href="/image/tablogo.png">
  <link rel="stylesheet" href="/css/home.css">
  <link rel="stylesheet" href="/css/chart.css">
  <link rel="stylesheet" href="/css/slide.css">

</head>

<body>
  <%- include('partials/header') %>
  <section class="section container" id="section-1">
    <%- include('partials/slide',{slides:slides}) %>
  </section>
  <section class="section container" id="section-2">
    <h3>
      <i class="far fa-newspaper"></i> L·ªãch ra truy·ªán ng√†y <%= new Date().getDate()%>/<%= new Date().getMonth() + 1 %>/<%= new Date().getFullYear() %>
    </h3>
    <div class="timeline" style="overflow-y: scroll;height: 200px;">
      <% mangaToday.forEach(function(manga,index){  %>
      <div class="d-flex border-bottom">
        <p><i class="fas fa-dot-circle"></i> <b><%= manga.Mangas.name %> : </b>
        </p>
        <div class="d-flex flex-column">
          <div class="flex ml-2">
            [ <%=  moment(manga.chapters.createdTime).locale("vi").fromNow() %> ]
            <a href="/detail/<%= manga.Mangas.slug %>">
              Ch∆∞∆°ng <%= manga.chapters.chapterNumber %> -
              <%= manga.chapters.chapterName %>
            </a>
          </div>
        </div>
      </div>
      <% }) %>
    </div>
    <hr>
    <h3><i class="fas fa-hourglass-half"></i> L·ªãch C·∫≠p Nh·∫≠t G·∫ßn ƒê√¢y</h3>
    <div class="timeline">
      <% recentlyReleasedManga.forEach(function(manga,index){  %>
      <p class="border-bottom">
        <b><i class="fas fa-dot-circle"></i> <%= manga.Mangas.name %> :</b>
        <span class="badge badge-primary text-capitalize">
          <%= moment(manga.chapters.createdTime).locale("vi").fromNow() %>
        </span>
        <a href="/detail/<%= manga.Mangas.slug %>">
          <% manga.Mangas.name %> Ch∆∞∆°ng <%=  manga.chapters.chapterNumber%> : <%=  manga.chapters.chapterName%>
        </a>
        <span class="badge badge-danger"><%= manga.Mangas.hot === true ? "Hot" : "" %></span>
      </p>
      <% }) %>
    </div>
    <!-- ********************* -->
  </section>
  <section class="section container" id="section-3">
    <a href="/just-updated?page=1&limit=2">
      <h3 class="text-info"><i class="fas fa-book-reader"></i> M·ªõi c·∫≠p nh·∫≠t</h3>
    </a>
    <div class="row">
      <% mangas.forEach(function(manga,index){ %>
      <%- include('partials/mangaList.ejs',{manga:manga}) %>
      <% }); %>
    </div>
    <div class="text-center m-4">
      <a href="/just-updated?page=1&limit=2" class="btn btn-danger">Xem th√™m nhi·ªÅu truy·ªán</a>
    </div>
  </section>
  <%- include('partials/rankCharts') %>
  <section class="section container" id="section-4">
    <a href="/popular/all?page=1&limit=2">
      <h3 style="color:rgb(54, 211, 54)"><i class="fas fa-venus-mars"></i> Truy·ªán t·ªïng h·ª£p</h3>
    </a>
    <div class="row">

      <% mangaForAll.forEach(function(manga){ %>
      <%- include('partials/mangaList.ejs',{manga:manga}) %>
      <%})%>

    </div>
    <div class="text-center m-4">
      <a href="/popular/all?page=1&limit=2" class="btn btn-danger">Xem th√™m nhi·ªÅu truy·ªán</a>
    </div>
  </section>
  <section class="section container" id="section-5">
    <a href="/popular/male?page=1&limit=2">
      <h3 style="color:#3088F3"><i class="fas fa-mars"></i> Truy·ªán con trai</h3>
    </a>
    <div class="row">
      <% mangaForMale.forEach(function(manga){ %>
      <%- include('partials/mangaList.ejs',{manga:manga}) %>
      <% }); %>
    </div>
    <div class="text-center m-4">
      <a href="/popular/male?page=1&limit=2" class="btn btn-danger">Xem th√™m nhi·ªÅu truy·ªán</a>
    </div>
  </section>
  <section class="section container mb-4" id="section-6">
    <a href="/popular/female?page=1&limit=2">
      <h3 style="color: #fa1c49"><i class="fas fa-venus"></i> Truy·ªán con g√°i</h3>
    </a>
    <div class="row">
      <% mangaForFemale.forEach(function(manga){ %>
      <%- include('partials/mangaList.ejs',{manga:manga}) %>
      <% }); %>
    </div>
    <div class="text-center m-4">
      <a href="/popular/female?page=1&limit=2" class="btn btn-danger">Xem th√™m nhi·ªÅu truy·ªán</a>
    </div>
  </section>
  <%- include('partials/footer') %>
</body>
<%- include("partials/script") %>
<script src="/js/tooltip.js"></script>
<script>
  // ScrollReveal().reveal('.manga-card', {
  //   // delay: 500,
  //   interval: 100,
  //   scale: 1.5,
  //   // reset: true,
  // })
</script>
<script>
  fetch('/chart/daily')
    .then((response) => response.json())
    .then((result) => {
      console.log(result)
      const htmls = result.data.map((manga, index) => `
      <li class="rank d-flex rank-${index + 1}">
        <div class="rank__number p-1">
          <b>${index + 1}</b>
        </div>
        <div class="rank__img">
          <a href="/detail/${manga.Mangas[0].slug}">
            <img src="${manga.Mangas[0].image}" alt="">
          </a>
        </div>
        <div class="rank__info d-flex aligh-items-center flex-column">
          <a href="/detail/${manga.Mangas[0].slug}">
            <b>${manga.Mangas[0].name}</b>
            <p>Chapter ${manga.chapters.chapterNumber}</p>
          </a>
          <a href="/detail/${manga.Mangas[0].slug}/read/chapter-${manga.chapters.chapterNumber}">
            <p>${manga.chapters.chapterName}</p>
          </a>
          <div>
            <i class="fas fa-eye"></i> ${manga.chapters.statistical.views}
          </div>
        </div>
      </li>

     `).join("")
      document.getElementById("chart-col-1").innerHTML = `
     <div class="chart">
      <div id="chart-1"/>
       <p class="header-1">Ô∏èüèÖ Top ng√†y Ô∏èüéâ</p>
       <h3 class="header-2">Top 10 Manga n·ªïi b·∫≠t</h3>
       <ul>
         ${htmls}
       </ul>
        </div>
     </div>`
    }).catch(error => console.log(error))

  fetch('/chart/weekly')
    .then((response) => response.json())
    .then((result) => {
      console.log(result)
      const htmls = result.data.map((manga, index) => `
   <li class="rank d-flex rank-${index + 1}">
     <div class="rank__number p-1">
       <b>${index + 1}</b>
     </div>
     <div class="rank__img">
       <a href="/detail/${manga.Mangas[0].slug}">
         <img src="${manga.Mangas[0].image}" alt="">
       </a>
     </div>
     <div class="rank__info d-flex aligh-items-center flex-column">
       <a href="/detail/${manga.Mangas[0].slug}">
         <b>${manga.Mangas[0].name}</b>
         <p>Chapter ${manga.chapters.chapterNumber}</p>
       </a>
       <a href="/detail/${manga.Mangas[0].slug}/read/chapter-${manga.chapters.chapterNumber}">
         <p>${manga.chapters.chapterName}</p>
       </a>
       <div>
         <i class="fas fa-eye"></i> ${manga.chapters.statistical.views}
       </div>
     </div>
   </li>

  `).join("")
      document.getElementById("chart-col-2").innerHTML = `
  <div class="chart">
    <div id="chart-2" />
    <p class="header-1">Ô∏èüèÖ Top tu·∫ßn Ô∏èüéâ</p>
    <h3 class="header-2">Top 10 Manga n·ªïi b·∫≠t</h3>
    <ul>
      ${htmls}
    </ul>
  </div>
  </div>`
    }).catch(error => console.log(error))

  fetch('/chart/monthly')
    .then((response) => response.json())
    .then((result) => {
      console.log(result)
      const htmls = result.data.map((manga, index) => `
    <li class="rank d-flex rank-${index + 1}">
      <div class="rank__number p-1">
        <b>${index + 1}</b>
      </div>
      <div class="rank__img">
        <a href="/detail/${manga.Mangas[0].slug}">
          <img src="${manga.Mangas[0].image}" alt="">
        </a>
      </div>
      <div class="rank__info d-flex aligh-items-center flex-column">
        <a href="/detail/${manga.Mangas[0].slug}">
        <b>${manga.Mangas[0].name}</b>
        <p>Chapter ${manga.chapters.chapterNumber}</p>
        </a>
        <a href="/detail/${manga.Mangas[0].slug}/read/chapter-${manga.chapters.chapterNumber}">
        <p>${manga.chapters.chapterName}</p>
        </a>
        <div>
          <i class="fas fa-eye"></i> ${manga.chapters.statistical.views}
        </div>
      </div>
    </li>

    `).join("")
      document.getElementById("chart-col-3").innerHTML = `
    <div class="chart">
      <div id="chart-3"/>
      <p class="header-1">Ô∏èüèÖ Top th√°ng Ô∏èüéâ</p>
      <h3 class="header-2">Top 10 Manga n·ªïi b·∫≠t</h3>
      <ul>
        ${htmls}
      </ul>
    </div>
    </div>`
    }).catch(error => console.log(error))
</script>

</html>